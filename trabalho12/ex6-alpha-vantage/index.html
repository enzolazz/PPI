<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <title>Cotações de Ações</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <h1 class="text-center mb-4">Consulta de Cotações - B3</h1>

      <form id="form-acoes" class="row g-3 justify-content-center mb-5">
        <div class="col-md-3">
          <input
            type="text"
            class="form-control"
            id="acao1"
            placeholder="Ex: PETR4.SA"
          >
        </div>
        <div class="col-md-3">
          <input
            type="text"
            class="form-control"
            id="acao2"
            placeholder="Ex: VALE3.SA"
          >
        </div>
        <div class="col-md-3">
          <input
            type="text"
            class="form-control"
            id="acao3"
            placeholder="Ex: ITUB4.SA"
          >
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
      </form>

      <div id="resultado" class="row g-4 justify-content-center"></div>
    </div>

    <script>
      const apiKey = "2XDTLW0H0W2IJ3W0";

      async function buscaCotacao(simbolo) {
        const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${simbolo}&apikey=${apiKey}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error("Erro na requisição");
        const data = await response.json();
        return {
          simbolo,
          preco: data["Global Quote"]["05. price"],
        };
      }

      function criarCard(quote) {
        if (!quote || Object.keys(quote).length === 0) {
          return `
                <div class="col-md-4">
                  <div class="card border-danger shadow">
                    <div class="card-body">
                      <h5 class="card-title text-danger">Ação não encontrada</h5>
                    </div>
                  </div>
                </div>
              `;
        }

        return `
        <div class="col-md-4">
          <div class="card shadow">
            <div class="card-body">
              <h5 class="card-title fw-bold">${quote["01. symbol"]}</h5>
              <p><strong>Abertura:</strong> ${quote["02. open"]}</p>
              <p><strong>Máxima:</strong> ${quote["03. high"]}</p>
              <p><strong>Mínima:</strong> ${quote["04. low"]}</p>
              <p><strong>Preço Atual:</strong> ${quote["05. price"]}</p>
              <p><strong>Volume:</strong> ${quote["06. volume"]}</p>
              <p><strong>Última negociação:</strong> ${quote["07. latest trading day"]}</p>
              <p><strong>Fechamento anterior:</strong> ${quote["08. previous close"]}</p>
              <p><strong>Variação:</strong> ${quote["09. change"]} (${quote["10. change percent"]})</p>
            </div>
          </div>
        </div>
      `;
      }

      document
        .getElementById("form-acoes")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const simbolos = [
            document.getElementById("acao1").value.trim(),
            document.getElementById("acao2").value.trim(),
            document.getElementById("acao3").value.trim(),
          ];

          try {
            const acao1 = buscaCotacao(simbolos[0]);
            const acao2 = buscaCotacao(simbolos[1]);
            const acao3 = buscaCotacao(simbolos[2]);

            const resultados = await Promisse.all([acao1, acao2, acao3]);
            document.getElementById("resultado").innerHTML = resultados
              .map(criarCard)
              .join("");
          } catch (err) {
            console.error(err);
            document.getElementById("resultado").innerHTML = `
          <div class="alert alert-danger">Erro ao buscar cotações.</div>
        `;
          }
        });
    </script>
  </body>
</html>
